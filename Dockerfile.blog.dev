FROM node:20-slim

# Install Zola for the correct architecture
RUN apt-get update && apt-get install -y curl wget \
    && ARCH=$(dpkg --print-architecture) \
    && if [ "$ARCH" = "amd64" ]; then \
         wget -O zola.tar.gz https://github.com/getzola/zola/releases/download/v0.20.0/zola-v0.20.0-x86_64-unknown-linux-gnu.tar.gz; \
       elif [ "$ARCH" = "arm64" ]; then \
         wget -O zola.tar.gz https://github.com/getzola/zola/releases/download/v0.20.0/zola-v0.20.0-aarch64-unknown-linux-gnu.tar.gz; \
       fi \
    && tar xzf zola.tar.gz -C /usr/local/bin \
    && rm zola.tar.gz \
    && chmod +x /usr/local/bin/zola \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY blog/package*.json ./
RUN npm install
COPY blog .

# Ensure public directory exists and copy input.css from static to public (matching normal workflow)
RUN mkdir -p public && cp static/input.css public/input.css

EXPOSE 1111
CMD ["sh", "-c", "npm run serve"]